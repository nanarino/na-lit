---
import App from "@/layouts/app.astro"
---

<App title="下拉氣泡">
    <script>
        // 丐版實現，點擊頁面任意位置都會導致自動關閉
        // import "@/components/Dropdown"

        // 完美實現， 需要 Chrome ≥ 125
        import "@/components/Dropdown/next"

        // 兼容實現，點擊元件外部無法關閉， Chrome ＜ 114 時使用 比如 WIN 7
        // import "@/components/Dropdown/old"
    </script>
    <section>
        <na-dropdown>
            <button class="na-button"> 連絡先 </button>
            <button class="na-button" slot="dropdown">
                <iconify-icon icon="line-md:email" width="16" height="16">
                </iconify-icon>
                <span> email </span>
            </button>
            <button class="na-button" slot="dropdown">
                <iconify-icon icon="line-md:twitter" width="16" height="16">
                </iconify-icon>
                <span> twitter </span>
            </button>
            <button class="na-button" slot="dropdown">
                <iconify-icon icon="line-md:instagram" width="16" height="16">
                </iconify-icon>
                <span> instagram </span>
            </button>
        </na-dropdown>

        <hr class="na-divider" />

        <!-- `dialog-popover="manual"` 會禁用自動關閉 -->
        <na-dropdown dialog-popover="manual">
            <button class="na-button" style="--color-button: var(--red-6);">
                <iconify-icon
                    icon="line-md:youtube-filled"
                    width="24"
                    height="24"
                >
                </iconify-icon>
            </button>
            <button class="na-button" slot="dropdown">
                <iconify-icon icon="line-md:thumbs-up" width="16" height="16">
                </iconify-icon>
                <span> I Like </span>
            </button>
            <button class="na-button" slot="dropdown">
                <iconify-icon icon="line-md:star" width="16" height="16">
                </iconify-icon>
                <span> Add Star </span>
            </button>
            <button class="na-button" slot="dropdown">
                <iconify-icon
                    icon="line-md:download-outline"
                    width="16"
                    height="16"
                >
                </iconify-icon>
                <span> Download </span>
            </button>
        </na-dropdown>
    </section>
    <script>
        async function onload() {
            // code-ignore-start
            const loadingElements = document.querySelectorAll(":not(:defined)")
            const tags = new Set([...loadingElements].map(ele => ele.localName))
            await Promise.all(
                [...tags].map(tag => customElements.whenDefined(tag))
            )
            // code-ignore-end
            for (const element of document.querySelectorAll("na-dropdown")) {
                console.log(element.dialog)
                // 程式控制氣泡框：
                // dialog.togglePopover()
                // dialog.showPopover()
                // dialog.hidePopover()
            }
        }

        // code-ignore-start
        document.addEventListener("astro:after-swap", e => {
            if (e.target) {
                const pathname = (e.target as Document).location.pathname
                const base = import.meta.env.BASE_URL
                const components = pathname.replace(RegExp(`^${base}`), "")
                if (components === "na-dropdown") onload()
            }
        })
        // code-ignore-end

        onload()
    </script>
    <style>
        [slot="dropdown"] {
            gap: 4px;
        }

        na-dropdown:not([data-loaded]) [slot="dropdown"] {
            display: none;
        }

        [dialog-popover="manual"] {
            align-self: end;
        }
    </style>
</App>

<style>
    section {
        padding: 2rem;
        display: flex;
        flex-direction: column;
    }

    hr {
        width: 100%;
    }

    iconify-icon {
        width: attr(width px);
        height: attr(height px);
    }
</style>
